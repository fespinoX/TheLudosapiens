<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Zombienauts</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
    <!-- JQUERY -->

    <link rel="shortcut icon" href="cositas/favicon.ico" type="image/x-icon">
    <!-- FAVICON -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- BOOTSTRAP -->

    <link rel="stylesheet" type="text/css" href="cositas/fuentes/stylesheet-telegram.css"/> 
    <!-- TELEGRAM -->

    <link rel="stylesheet" type="text/css" href="cositas/fuentes/stylesheet-ipixelu.css"/> 
    <!-- I PIXEL U -->
    
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- BOOTSTRAP -->

    <link rel="stylesheet" href="css/estilo.css">

</head>



    <style>
      #map {
        height: 600px;
        width: 100%;
      }

      .item{
        height: 310px;
      }

      .pie{
        position: absolute;
        bottom: 55px;
        width: 90%;
      }

      .izq{
        height: 30px;
        padding-top: 6px;
      }

      .izq span{
        font-size: 13px;
        vertical-align: middle;
        height: 30px;
      }

      .portaIconoLista{
        width: 40px;
      }

      .portaIconoLista,
      .portaInfoLista{
        display: inline-block;
      }

      .portaIconoLista p{
        text-align: center;
      }

      .portaRedes{
        display: inline-block;
        font-size: 25px;
        margin-left: 10px;
      }

      a::after{
    display: none!important;
  }

    </style>

<body id="listado">

<section class="jumbotron">
<div class="jumbotron_bar">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <ol class="breadcrumb pull-left">
            <li><a href="/">Inicio</a></li>
            <li class="active">Listado de juegos</li>
          </ol>                    
        </div>
      </div>
    </div>
  </div>
  <div class="jumbotron_body">
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-8 col-md-offset-2 text-center">
          <h2>Listado de juegos</h2>
          <p>Acá vas a encontrar todos los juegos en stock, ofertas y otras cositas.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="overlay"></div>
</section>

<div class="container">
  <section id="buscadorjuegos">
    <div id="juegos">
      <div class="row">
        <div class="col-md-6">    
          <div class="form-group">
            <label>Buscá por juego</label>
            <input class="form-control search" placeholder="Buscá juegos por nombre o descripcion">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="">Editorial</label>
            <select id="tipo-editorial" class="form-control">
              <option value="Todas">Todas</option>
              <option value="Days of Wonder">Days of Wonder</option>
              <option value="Fantasy Flight">Fantasy Flight</option>
              <option value="Otra">Otra</option>
            </select>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="">Tipo de juego</label>
            <select id="tipo-juego" class="form-control">
              <option value="Todos">Todos</option>
              <option value="Entry">Entry</option>
              <option value="Party">Party</option>
              <option value="Euro">Euro</option>
              <option value="Ameritrash">Ameritrash</option>
            </select>
          </div>
        </div>
      </div>
      <div class="row">
      </div>
      <div>
      <div class="list row panels-row m-y-3 state-loading" data-render="tarjetas">
      </div>
      <div class="row" id="alerta-msj">
        <div class="col-md-8 col-md-offset-2">
          <div class="alert alert-warning">
            <div class="media">
              <div class="media-left media-middle">
                <i class="fa fa-warning fa-fw fa-2x"></i>
              </div>
              <div class="media-body">
                <p>Se están cargando todos los juegos. Este proceso puede tardar aproximadamente un minuto.</p>
              </div>
            </div>          
          </div>
        </div>        
      </div>
      <nav class="text-center">
        <ul class="pagination"></ul>
      </nav>       
      </div>
    </div>
  </section> 

</div>


<div data-render="modales"></div> 

<div class="container">
 <div class="row">
   <div class="col-md-12">
     <div id="alerta" class="alert alert-warning col-md-4 no-result hide">
      <div class="media">
        <div class="media-left media-middle">
          <i class="fa fa-warning fa-fw fa-2x"></i>
        </div>
        <div class="media-body">
          <p>No hay resultados para mostrar</p>
        </div>
      </div>
    </div> 
   </div>
 </div>  
</div>

</body>

<!--
<script src="{{ "/node_modules/list.js/dist/list.min.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/node_modules/moment/min/moment.min.js" | prepend: site.baseurl }}"></script>
<script src="{{ "/node_modules/moment/locale/es.js" | prepend: site.baseurl }}"></script>
-->

<script src="https://www.argentina.gob.ar/profiles/argentinagobar/themes/argentinagobar/argentinagobar_theme/js/listjs/list.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.pagination.js/0.1.1/list.pagination.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/locale/es.js"></script>

<script>



  (function($){


    var templates = {
      tarjeta: `<div class="col-xs-12 col-sm-6 col-md-4 item">
    <a href="#juegos-{index}" data-toggle="modal" class="panel panel-default">
        <div class="panel-body">
            <div class="media">
                <div class="media-left media-middle">
                    <span class="fa {icono} fa-2x fa-fw" aria-hidden="true"></span>
                </div>
                <div class="media-body media-middle">
                    <div class="text-muted">
                        <h4>{tipodejuego}</h4>
                    </div>
                </div>
                <h3 class="nombre-juego m-t-1">{titulo}</h3>
                <p class="text-muted descripcion-juego">{descripcion}</p>
            </div>
        </div>
    </a>
</div>`,

    tarjeta_destacado: `<div class="col-xs-12 col-sm-6 col-md-4 item">
    <a href="#juegos-{index}" data-toggle="modal" class="panel panel-default">
        <div class="panel-body">
            <div class="media">
                <div class="media-left media-middle">
                    <span class="fa {icono} fa-2x fa-fw" aria-hidden="true"></span>
                </div>
                <div class="media-body media-middle">
                    <div class="text-muted">
                        <h4>{tipodejuego}</h4>
                    </div>
                </div>
                <h3 class="nombre-juego m-t-1">{titulo}</h3>
                <p class="text-muted descripcion-juego">{descripcion}</p>
                <div class="pie">
                <div class="izq">
                  <p>
                    <span class="label label-success">Juego en oferta!</span>
                  </p>
                </div>
                </div>
            </div>
        </div>
    </a>
</div>`,
      modal_n: `<div id="juegos-{index}" class="modal fade" tabindex="-1" role="dialog"> 
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header bg-primary">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span> </button> 
                      <h4 class="h5 nombre-juego modal-title">{titulo}</h4>
                    </div>
                    <div class="modal-body p-b-3">  
                      <p class="text-muted descripcion-juego m-t-1">{descripcion}</p>
                      <div class="text-muted">
                        {editorial}
                        {precio}
                        {stock}
                      </div>
                    </div>
                  </div>
                </div>
              </div>`,
      modal_v: `<div id="juegos-{index}" class="modal fade" tabindex="-1" role="dialog"> 
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header bg-primary">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span> </button> 
                      <h4 class="nombre-juego modal-title">{titulo}</h4>
                    </div>
                    <div class="modal-body p-b-3"> 
                      <p class="text-muted descripcion-juego m-t-1">{descripcion}</p>
                      <div class="text-muted">
                        {editorial}
                        {precio}
                        {stock}
                      </div>
                    </div>
                    <div class="modal-body p-b-3">
                      <div class="embed-responsive embed-responsive-16by9">
                        <iframe class="embed-responsive-item" src="{video}" frameborder="0" allowfullscreen></iframe>
                      </div>
                    </div>
                  </div>
                </div>
              </div>`,
      modal_im: `<div id="juegos-{index}" class="modal fade" tabindex="-1" role="dialog"> 
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header bg-primary">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span> </button> 
                      <h4 class="nombre-juego modal-title">{titulo}</h4>
                    </div>
                    <div class="modal-body p-b-3">   
                      <p class="text-muted descripcion-juego m-t-1">{descripcion}</p>
                      <div class="text-muted">
                        {editorial}
                        {precio}
                        {stock}
                      </div>
                    </div>
                    <div class="modal-body p-b-3">
                      <div class="embed-responsive embed-responsive-16by9">
                        
                      <img src="{imagen}" alt="imagen de juego pública"/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>`,
    }

    window.juegos = [];
    window.configjuegos = 'Todos';
    window.configeditorial = 'Todas';

    $.ajax({
      url: 'https://spreadsheets.google.com/feeds/list/1pkf9Sb3y7m81HSq3WTud6lbdDQS0NUvnBvVC_-Vo5LU/1/public/values?alt=json',
      data: 'json',
      success: function(response){

        /*console.log(response.feed.entry);*/

        $.each(response.feed.entry, function(index, row){

          
            juegos.push({
              index: index,
              tipodejuego: row.gsx$tipodejuego.$t,
              titulo: row.gsx$titulo.$t,
              icono: row.gsx$icono.$t,
              descripcion: row.gsx$descripcion.$t,
              video: row.gsx$video.$t,
              imagen: row.gsx$imagen.$t,
              editorial: row.gsx$editorial.$t,
              precio: row.gsx$precio.$t,
              destacado: row.gsx$destacado.$t,
              stock: row.gsx$stock.$t
            });


        })

        render.tarjetas();
        $('div[data-render="tarjetas"]').removeClass('state-loading');
        $('#alerta-msj').hide();



      }
    });


    var render = {
      tarjetas: function( ){

        $('[data-render=tarjetas]').html('');
        $('[data-render=modales]').html('');

       var html_tarjetas = "";


        $.each(juegos, function(index, juegos){


          if( (configjuegos == 'Todos' || juegos.tipodejuego.indexOf(configjuegos) > -1) && (configeditorial == 'Todas' || juegos.editorial.indexOf(configeditorial) > -1 ) ) {            

            if(juegos.destacado){
              html_tarjetas = templates.tarjeta_destacado;
            }else{
              html_tarjetas = templates.tarjeta;
            }


            if (juegos.editorial == "" || juegos.editorial == "-" ){
              var editorial = '';
            } else {
              var editorial = '<div class="media m-t-1"><div class="portaIconoLista"><p><i class="fa icono-arg-barrio"></i></p></div><div class="portaInfoLista"><p><b>editorial:</b>' + ' <span>' + juegos.editorial + '</span></p></div></div>';
            }

            if (juegos.precio == "" || juegos.precio == "-" ){
              var precio = '';
            } else {
              var precio = '<div class="media m-t-1"><div class="portaIconoLista"><p><i class="fa icono-arg-genero"></i></p></div><div class="portaInfoLista"><p><b>precio:</b>' + ' <span>' + juegos.precio + '</span></p></div></div>';
            }

            if (juegos.stock == "" || juegos.stock == "-" ){
              var stock = '';
            } else {
              var stock = '<div class="media m-t-1"><div class="portaIconoLista"><p><i class="fa fa-cog"></i></p></div><div class="portaInfoLista"><p><b>stock:</b>' + ' <span>' + juegos.stock + '</span></p></div></div>';
            }

            
            var modal_n = templates.modal_n;
            var modal_v = templates.modal_v;
            var modal_im = templates.modal_im;

            html_tarjetas = html_tarjetas.replace(/{titulo}/gi, juegos.titulo)
            .replace(/{index}/gi, index)
            .replace(/{tipodejuego}/gi, juegos.tipodejuego)
            .replace(/{descripcion}/gi, juegos.descripcion.substring(0, 100) + '...')
            .replace(/{icono}/gi, juegos.icono),

            modal_n = modal_n.replace(/{index}/gi, index)
            .replace(/{titulo}/gi, juegos.titulo)
            .replace(/{descripcion}/gi, juegos.descripcion)
            .replace(/{editorial}/gi, editorial)
            .replace(/{precio}/gi, precio)
            .replace(/{stock}/gi, stock);

            modal_v = modal_v.replace(/{index}/gi, index)
            .replace(/{titulo}/gi, juegos.titulo)
            .replace(/{descripcion}/gi, juegos.descripcion)
            .replace(/{video}/gi, juegos.video)
            .replace(/{imagen}/gi, juegos.imagen)
            .replace(/{editorial}/gi, editorial)
            .replace(/{precio}/gi, precio)
            .replace(/{stock}/gi, stock);

            modal_im = modal_im.replace(/{index}/gi, index)
            .replace(/{titulo}/gi, juegos.titulo)
            .replace(/{descripcion}/gi, juegos.descripcion)
            .replace(/{video}/gi, juegos.video)
            .replace(/{imagen}/gi, juegos.imagen)
            .replace(/{editorial}/gi, editorial)
            .replace(/{precio}/gi, precio)
            .replace(/{stock}/gi, stock);



            $('[data-render=tarjetas]').append( html_tarjetas );
     

            $('[data-toggle="modal"]').click( function() {
              var id = $(this).attr('href').substr(1);
              if('juegos-' + index == id){
                $('[data-render=modales]').html('');
                if(juegos.video){
                  $('[data-render=modales]').append( modal_v ); 
                }else if(juegos.imagen){
                  $('[data-render=modales]').append( modal_im ); 
                }else{
                  $('[data-render=modales]').append( modal_n ); 
                }

              }              
            })


          }

          if (html_tarjetas == "") {
                $('.no-result').show();
                $('.list').hide();//se esconde para sacar marginado cuando no hay resultados
          }
          else {
                $('.no-result').hide();
                $('.list').show();
          } 


        });

        var listOptions = { 
          valueNames: [ 'nombre-juego', 'descripcion-juego' ], 
          page: 18,
          plugins: [ ListPagination({}) ]
        };

        var juegosList = new List('juegos', listOptions);
        var noItems = $('<p>nada de nada</p>');

        //$('.no-result').hide();

        juegosList.on('updated', function(list) {
          if (list.matchingItems.length == 0) {
            $(list.list).append(noItems);
          } else {
            noItems.detach();
          }
        })         

      }   

    }

    $("#tipo-editorial").on("change", function() {
      configeditorial = $( "#tipo-editorial option:selected" ).val();
      render.tarjetas();
    });

    $("#tipo-juego").on("change", function() {
      configjuegos = $( "#tipo-juego option:selected" ).val();
      render.tarjetas();
    });



  })(jQuery);


     
</script>
    

